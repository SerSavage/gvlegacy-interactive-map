<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloria Victis Interactive Map</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #000; color: #fff; overflow: hidden; }
        .topmenu { background: #333; padding: 10px; text-align: center; z-index: 1000; position: relative; }
        .topmenu a { color: #fff; text-decoration: none; margin: 0 15px; }
        .topmenu a:hover { color: #ffff00; }
        #map-container { 
            width: 100%; 
            height: calc(100vh - 50px); 
            background: #1a1a1a; 
            overflow: auto;
            position: relative;
        }
        #map-canvas {
            display: block;
            background: #1a1a1a;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 18px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="topmenu">
        <a href="#">Home</a>
        <a href="#">Interactive Map</a>
        <a href="#">Item Database</a>
        <a href="#">Workshop</a>
        <a href="#">Character Builder</a>
    </div>
    <div id="map-container">
        <div class="loading" id="loading">Loading map tiles...</div>
        <canvas id="map-canvas"></canvas>
    </div>
    <script>
        console.log('=== Gloria Victis Interactive Map ===');
        
        var TILE_SIZE = 256;
        var MAP_WIDTH_TILES = 21;
        var MAP_HEIGHT_TILES = 18;
        var MAP_WIDTH_PX = MAP_WIDTH_TILES * TILE_SIZE;
        var MAP_HEIGHT_PX = MAP_HEIGHT_TILES * TILE_SIZE;
        
        var canvas = document.getElementById('map-canvas');
        var ctx = canvas.getContext('2d');
        var loadingDiv = document.getElementById('loading');
        
        // Set canvas size
        canvas.width = MAP_WIDTH_PX;
        canvas.height = MAP_HEIGHT_PX;
        
        console.log('Map dimensions: ' + MAP_WIDTH_TILES + 'x' + MAP_HEIGHT_TILES + ' tiles');
        console.log('Pixel dimensions: ' + MAP_WIDTH_PX + 'x' + MAP_HEIGHT_PX);
        
        // Fill background
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(0, 0, MAP_WIDTH_PX, MAP_HEIGHT_PX);
        
        var areas = ['Main', 'GC1', 'ArenaTournament'];
        var totalTiles = MAP_WIDTH_TILES * MAP_HEIGHT_TILES;
        var loadedTiles = 0;
        var failedTiles = 0;
        
        // Load all tiles
        function loadTile(x, y, area, callback) {
            var img = new Image();
            var tilePath = '/GVmaptiles/x' + x + 'y' + y + '_' + area + '.png';
            
            img.onload = function() {
                // Draw at correct position
                var px = x * TILE_SIZE;
                var py = y * TILE_SIZE;
                ctx.drawImage(img, px, py);
                callback(true);
            };
            
            img.onerror = function() {
                callback(false);
            };
            
            img.src = tilePath;
        }
        
        // Load all tiles for all areas
        var allLoaded = 0;
        var totalToLoad = totalTiles * areas.length;
        
        for (var y = 0; y < MAP_HEIGHT_TILES; y++) {
            for (var x = 0; x < MAP_WIDTH_TILES; x++) {
                areas.forEach(function(area) {
                    loadTile(x, y, area, function(success) {
                        allLoaded++;
                        if (success) {
                            loadedTiles++;
                        } else {
                            failedTiles++;
                        }
                        
                        // Update loading message
                        var percent = Math.round((allLoaded / totalToLoad) * 100);
                        loadingDiv.textContent = 'Loading map tiles... ' + percent + '% (' + loadedTiles + ' loaded)';
                        
                        if (allLoaded >= totalToLoad) {
                            loadingDiv.style.display = 'none';
                            console.log('Map loaded! ' + loadedTiles + ' tiles loaded, ' + failedTiles + ' missing');
                            console.log('Map is ready!');
                        }
                    });
                });
            }
        }
        
        // Zoom with mouse wheel
        var scale = 1;
        var container = document.getElementById('map-container');
        
        container.addEventListener('wheel', function(e) {
            e.preventDefault();
            var delta = e.deltaY > 0 ? 0.9 : 1.1;
            scale = Math.max(0.5, Math.min(3, scale * delta));
            canvas.style.transform = 'scale(' + scale + ')';
            canvas.style.transformOrigin = 'top left';
        });
        
        // Pan with mouse drag
        var isDragging = false;
        var startX, startY, scrollLeft, scrollTop;
        
        container.addEventListener('mousedown', function(e) {
            isDragging = true;
            startX = e.pageX - container.offsetLeft;
            startY = e.pageY - container.offsetTop;
            scrollLeft = container.scrollLeft;
            scrollTop = container.scrollTop;
        });
        
        container.addEventListener('mouseleave', function() {
            isDragging = false;
        });
        
        container.addEventListener('mouseup', function() {
            isDragging = false;
        });
        
        container.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            e.preventDefault();
            var x = e.pageX - container.offsetLeft;
            var y = e.pageY - container.offsetTop;
            var walkX = (x - startX) * 2;
            var walkY = (y - startY) * 2;
            container.scrollLeft = scrollLeft - walkX;
            container.scrollTop = scrollTop - walkY;
        });
        
        console.log('=== Map Initialized ===');
    </script>
</body>
</html>
